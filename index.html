<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Presentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reset.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/theme/white.min.css">
    <link rel="stylesheet" href="css/theme.css">
</head>

<body>
    <div class="reveal">
        <div class="slides" id="slide-container">
            <!-- Slides will be injected here by JS -->
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reveal.min.js"></script>
    <script src="js/slides_data.js"></script>
    <script>
        // Main initialization script

        const container = document.getElementById('slide-container');
        document.title = presentationData.meta.title;

        presentationData.slides.forEach(slide => {
            const section = document.createElement('section');

            // Apply specific classes based on slide type
            section.classList.add(slide.type + '-slide');
            if (slide.type === 'dark' || slide.type === 'hero' || slide.type === 'reveal') {
                section.setAttribute('data-background-color', '#000000');
                section.classList.add('dark-mode');
            }

            let html = '';

            switch (slide.type) {
                case 'title':
                    html = `
                        <div class="title-content clickable-title">
                            <h1>${slide.title}</h1>
                            <p class="subtitle">${slide.subtitle}</p>
                            <div class="footer">${slide.footer}</div>
                        </div>
                    `;
                    break;

                case 'bento':
                    html = `
                        <h2>${slide.title}</h2>
                        <p class="subtext">${slide.subtitle || ''}</p>
                        <div class="bento-grid">
                            ${slide.items.map((item, index) => `
                                <div class="bento-item fragment fade-up ${item.highlight ? 'highlight' : ''}" data-fragment-index="${index}">
                                    <span class="icon">${item.icon}</span>
                                    <span class="label">${item.label}</span>
                                    <span class="text">${item.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;

                case 'big-statement':
                    html = `
                        <div class="center-content">
                            <h2 class="big-text fragment fade-in">${slide.title}</h2>
                            ${slide.subtitle ? `<p class="subtext fragment fade-in">${slide.subtitle}</p>` : ''}
                        </div>
                    `;
                    break;

                case 'list':
                    html = `
                        <h2>${slide.title}</h2>
                        <p class="subtext">${slide.subtitle || ''}</p>
                        <ul class="clean-list">
                            ${slide.items.map(item => `<li class="fragment fade-up">${item}</li>`).join('')}
                        </ul>
                    `;
                    break;

                case 'quote':
                    html = `
                        <h2>${slide.title}</h2>
                        <blockquote class="fragment fade-in">
                            "${slide.quote}"
                        </blockquote>
                        <p class="author fragment fade-in">â€” ${slide.author}</p>
                    `;
                    break;

                case 'equation':
                    html = `
                        <h2>${slide.title}</h2>
                        <p class="subtext">${slide.subtitle || ''}</p>
                        <div class="equation-container">
                            <div class="term fragment fade-in">${slide.left}</div>
                            <div class="operator fragment fade-in">${slide.operator}</div>
                            <div class="term fragment fade-in">${slide.right}</div>
                            <div class="operator fragment fade-in">=</div>
                            <div class="result fragment fade-in scale-up">${slide.result}</div>
                        </div>
                    `;
                    break;

                case 'highlight-box':
                    html = `
                        <div class="center-content">
                            <h2>${slide.title}</h2>
                            <div class="highlight-box fragment fade-in">${slide.text}</div>
                        </div>
                    `;
                    break;

                case 'grid-pills':
                    html = `
                        <h2>${slide.title}</h2>
                        <p class="subtext">${slide.subtitle || ''}</p>
                        <div class="grid-container">
                            ${slide.items.map(item => `<span class="grid-pill fragment fade-in">${item}</span>`).join('')}
                        </div>
                    `;
                    break;

                case 'image-text':
                    html = `
                        <div class="split-content">
                            <h2>${slide.title}</h2>
                            <p class="text-content">${slide.text}</p>
                            ${slide.image ? `<img src="${slide.image}" class="slide-image fragment fade-in" alt="Slide Image" style="max-width: 300px; margin: 20px auto; display: block;">` : ''}
                            <p class="highlight-box fragment fade-in">${slide.highlight}</p>
                        </div>
                    `;
                    break;
            }

            section.innerHTML = html;
            container.appendChild(section);
        });

        Reveal.initialize({
            hash: true,
            transition: 'fade', // Apple-like fade
            transitionSpeed: 'slow',
            backgroundTransition: 'fade',
            controls: false, // Cleaner look
            progress: false, // Cleaner look
            center: false, // Let CSS handle centering
            disableLayout: true // Full viewport mode
        });

        // Sound Effect Logic
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playBuzzer() {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = 'sawtooth'; // Buzzer-like wave
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime); // Low pitch
            oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.5); // Drop pitch

            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        // Click interaction for Title Slide
        document.addEventListener('click', (e) => {
            // Check if we are on the title slide
            const currentSlide = Reveal.getCurrentSlide();
            if (currentSlide && currentSlide.classList.contains('title-slide')) {
                const prefix = document.getElementById('title-prefix');
                if (prefix) {
                    // Single Step: Erase (Vanish)
                    if (!prefix.classList.contains('vanish')) {
                        prefix.classList.add('vanish');
                        // Optional: Play sound if desired for erase, or remove if silent
                        // playBuzzer(); 
                        e.stopPropagation();
                    }
                }
            }
        });
    </script>
</body>

</html>